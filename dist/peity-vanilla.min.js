/*!
  Peity Vanila JS 0.0.6
  Copyright Â© 2022 RailsJazz
  https://railsjazz.com
 */
var peity=function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var n=function(t){return null!==t&&"function"==typeof t&&!!t.apply},r=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)i.setAttribute(n,e[n]);return i},a="createElementNS"in document&&r("svg",{}).createSVGRect(),o=function(){function i(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t(this,i),this.element=e,this.type=n,this.options=Object.assign({},i.defaults[this.type],JSON.parse(e.dataset.peity||"{}"),r),this.element._peity&&this.element._peity.destroy(),this.element._peity=this}var o,s,l;return o=i,l=[{key:"register",value:function(t,e,n){i.defaults[t]=e,i.graphers[t]=n}}],(s=[{key:"draw",value:function(){var t=this.options;i.graphers[this.type](this),n(t.after)&&t.after.call(this,t)}},{key:"fill",value:function(){var t=this.options.fill;return n(t)?t:function(e,i){return t[i%t.length]}}},{key:"prepare",value:function(t,e){return this.svg||(this.element.style.display="none",this.element.after(this.svg=r("svg",{class:"peity"}))),this.svg.innerHTML="",this.svg.setAttribute("width",t),this.svg.setAttribute("height",e),this.svg}},{key:"values",get:function(){return this.element.innerText.split(this.options.delimiter).map((function(t){return parseFloat(t)}))}},{key:"mount",value:function(){a&&(this.element.addEventListener("change",this.draw.bind(this)),this.draw(),this.mounted=!0)}},{key:"unmount",value:function(){this.element.removeEventListener("change",this.draw),this.svg.remove(),this.mounted=!1}},{key:"destroy",value:function(){this.unmount(),delete this.element._peity}}])&&e(o.prototype,s),l&&e(o,l),Object.defineProperty(o,"prototype",{writable:!1}),i}();i(o,"defaults",{}),i(o,"graphers",{});var s=function(t){if(!t.options.delimiter){var e=t.element.innerText.match(/[^0-9\.]/);t.options.delimiter=e?e[0]:","}var i=t.values.map((function(t){return t>0?t:0}));if("/"==t.options.delimiter){var n=i[0],a=i[1];i=[n,Math.max(0,a-n)]}for(var o=0,s=i.length,l=0;o<s;o++)l+=i[o];l||(s=2,l=1,i=[0,1]);var h=2*t.options.radius,u=t.prepare(t.options.width||h,t.options.height||h),p=u.clientWidth,c=u.clientHeight,f=p/2,d=c/2,v=Math.min(f,d),m=t.options.innerRadius;"donut"!=t.type||m||(m=.5*v);var g=t.fill(),y=function(t,e){var i=t/l*Math.PI*2-Math.PI/2;return[e*Math.cos(i)+f,e*Math.sin(i)+d]},w=0;for(o=0;o<s;o++){var M=i[o],b=M/l,k=void 0;if(0!=b){if(1==b)if(m){var x=f-.01,j=d-v,A=d-m;k=r("path",{d:["M",f,j,"A",v,v,0,1,1,x,j,"L",x,A,"A",m,m,0,1,0,f,A].join(" "),"data-value":M})}else k=r("circle",{cx:f,cy:d,"data-value":M,r:v});else{var E=w+M,L=["M"].concat(y(w,v),"A",v,v,0,b>.5?1:0,1,y(E,v),"L");m?L=L.concat(y(E,m),"A",m,m,0,b>.5?1:0,0,y(w,m)):L.push(f,d),w+=M,k=r("path",{d:L.join(" "),"data-value":M})}k.setAttribute("fill",g.call(t,M,o,i)),u.append(k)}}},l={fill:["#ff9900","#fff4dd","#ffc66e"],radius:8};o.register("pie",l,s),o.register("donut",l,s),o.register("bar",{delimiter:",",fill:["#4D89F9"],height:16,min:0,padding:.1,width:32},(function(t){for(var e=t.values,i=Math.max.apply(Math,null==t.options.max?e:e.concat(t.options.max)),n=Math.min.apply(Math,null==t.options.min?e:e.concat(t.options.min)),a=t.prepare(t.options.width,t.options.height),o=a.clientWidth,s=a.clientHeight,l=i-n,h=t.options.padding,u=t.fill(),p=function(t){return t*o/e.length},c=function(t){return s-(l?(t-n)/l*s:1)},f=0;f<e.length;f++){var d=p(f+h),v=p(f+1-h)-d,m=e[f],g=c(m),y=g,w=g,M=void 0;l?m<0?y=c(Math.min(i,0)):w=c(Math.max(n,0)):M=1,0==(M=w-y)&&(M=1,i>0&&l&&y--),a.append(r("rect",{"data-value":m,fill:u.call(t,m,f,e),x:d,y:y,width:v,height:M}))}})),o.register("line",{delimiter:",",fill:"#c6d9fd",height:16,min:0,stroke:"#4d89f9",strokeWidth:1,width:32},(function(t){var e=t.values;1==e.length&&e.push(e[0]);for(var i=Math.max.apply(Math,null==t.options.max?e:e.concat(t.options.max)),n=Math.min.apply(Math,null==t.options.min?e:e.concat(t.options.min)),a=t.prepare(t.options.width,t.options.height),o=t.options.strokeWidth,s=a.clientWidth,l=a.clientHeight-o,h=i-n,u=function(t){var e=l;return h&&(e-=(t-n)/h*l),e+o/2},p=u(Math.max(n,0)),c=[0,p],f=0;f<e.length;f++)c.push(f*(s/(e.length-1)),u(e[f]));c.push(s,p),t.options.fill&&a.append(r("polygon",{fill:t.options.fill,points:c.join(" ")})),o&&a.append(r("polyline",{fill:"none",points:c.slice(2,c.length-2).join(" "),stroke:t.options.stroke,"stroke-width":o,"stroke-linecap":"square"}))}));var h=function(t,e,i){var n=new o(t,e,i);return n.mount(),n};return h.defaults=o.defaults,h.graphers=o.graphers,h}();
